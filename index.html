<!DOCTYPE html>
<html>
<head>
  <title>SMS Excel Plugin</title>
  <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
</head>

<body>
  <h2>ðŸ“© SMS Excel Plugin</h2>

  <p><b>Message Template</b></p>
  <textarea id="template" rows="4" cols="30">
Dear {name}, your amount is {amount}
  </textarea>

  <br><br>
  <button id="previewBtn">Preview Messages</button>

  <div id="output"></div>

  <script>
    Office.onReady(() => {
      document.getElementById("previewBtn").onclick = previewMessages;
    });

    function previewMessages() {
      Excel.run(async (context) => {
        const range = context.workbook.getSelectedRange();
        range.load("values");
        await context.sync();

        const rows = range.values;
        const template = document.getElementById("template").value;

        let html = "<b>Message Preview:</b><br/><br/>";

        rows.forEach(row => {
          const mobile = row[0];
          const name = row[1];
          const amount = row[2];

          if (mobile) {
            let msg = template
              .replace("{name}", name)
              .replace("{amount}", amount);

            html += mobile + " â†’ " + msg + "<br/>";
          }
        });

        document.getElementById("output").innerHTML = html;
      });
    }
  </script>
</body>
</html>
